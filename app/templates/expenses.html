{% extends "base.html" %}

{% block title %}Expenses{% endblock %}

{% block content %}
<div class="dashboard-header">
    <h1>Your Expenses</h1>
    <a href="{{ url_for('expenses.add_expense') }}" class="btn btn-primary"><i class="fa-solid fa-plus"></i> &nbsp;Add
        Expense</a>
</div>

<div class="card">
    <!-- Loop through expenses here -->
    {% if expenses %}
    <ul class="expense-list">
        {% for expense in expenses %}
        <li class="flex flex-col" style="padding: 1rem 0; border-bottom: 1px solid var(--border-color);">
            <div class="flex justify-between items-center" style="width: 100%;">
                <div class="flex flex-col">
                    <span style="font-weight: 600;">{{ expense.description }}</span>
                    <span class="text-muted" style="font-size: 0.85rem;">{{ expense.created_at.strftime('%Y-%m-%d')
                        }}</span>
                </div>
                <div class="flex flex-col items-end">
                    <span style="font-weight: 700;">${{ expense.amount }}</span>
                    <span class="text-muted" style="font-size: 0.85rem;">
                        {% if expense.paid_by_id == user.id %}
                        you paid
                        {% else %}
                        {{ expense.paid_by.name }} paid
                        {% endif %}
                        <a href="{{ url_for('expenses.edit_expense', expense_id=expense.id) }}"
                            class="text-primary ml-2" style="font-size: 0.8rem;"><i class="fa-solid fa-pen"></i></a>
                    </span>
                </div>
            </div>

            <div class="split-details" style="margin-top: 0.5rem; font-size: 0.8rem; color: var(--text-muted);">
                {% for split in expense.splits %}
                {% if split.user_id != expense.paid_by_id %}
                {% if expense.paid_by_id == user.id %}
                <div
                    style="margin-left: 2px; border-left: 2px solid var(--primary-color); padding-left: 8px; margin-bottom: 2px;">
                    You lent <strong>${{ split.amount }}</strong> to {{ split.user.name }}
                </div>
                {% elif split.user_id == user.id %}
                <div
                    style="margin-left: 2px; border-left: 2px solid var(--danger-color); padding-left: 8px; margin-bottom: 2px;">
                    {{ expense.paid_by.name }} lent you <strong>${{ split.amount }}</strong>
                </div>
                {% endif %}
                {% endif %}
                {% endfor %}
            </div>
        </li>
        {% endfor %}
    </ul>
    {% else %}
    <div class="text-center py-5">
        <p class="text-muted">You haven't added any expenses yet.</p>
    </div>
    {% endif %}
</div>
{% endblock %}