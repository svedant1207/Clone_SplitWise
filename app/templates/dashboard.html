{% extends "base.html" %}

{% block title %}Dashboard{% endblock %}

{% block content %}

<div class="dashboard-header">
    <div>
        <h1>Dashboard</h1>
        <p class="text-muted">Welcome back, {{ user.name }}!</p>
    </div>

    <div class="actions">
        <a href="{{ url_for('expenses.add_expense') }}" class="btn btn-primary">
            <i class="fa-solid fa-plus"></i>&nbsp;Add Expense
        </a>
        <a href="{{ url_for('settlements.settle_view') }}" class="btn btn-secondary">
            Settle Up
        </a>
    </div>
</div>


<div class="stats-grid">

    <!-- TOTAL BALANCE -->
    <div class="stat-card">
        <span class="stat-label">total balance</span>

        {% if total_balance >= 0 %}
            <span class="stat-value positive">
                + ${{ "%.2f"|format(total_balance) }}
            </span>
            <span class="text-muted">You are owed</span>
        {% else %}
            <span class="stat-value negative">
                ${{ "%.2f"|format(total_balance|abs) }}
            </span>
            <span class="text-muted">You owe</span>
        {% endif %}
    </div>

    <!-- YOU OWE -->
    <div class="stat-card">
        <span class="stat-label">you owe</span>
        <span class="stat-value negative">
            ${{ "%.2f"|format(you_owe) }}
        </span>
        <span class="text-muted">to {{ owe_count }} friends</span>
    </div>

    <!-- YOU ARE OWED -->
    <div class="stat-card">
        <span class="stat-label">you are owed</span>
        <span class="stat-value positive">
            ${{ "%.2f"|format(you_are_owed) }}
        </span>
        <span class="text-muted">by {{ owed_by_count }} friends</span>
    </div>

</div>


<div class="recent-activity">
    <h3 class="mb-4">Recent Activity</h3>

    <div class="card">
        {% if recent_expenses %}
            <ul class="expense-list">
                {% for expense in recent_expenses %}
                    <li class="expense-item">
                        <div>
                            <strong>{{ expense.description or "Expense" }}</strong><br>
                            <small class="text-muted">
                                {{ expense.created_at.strftime('%Y-%m-%d') }}
                            </small>
                        </div>

                        <div class="text-right">
                            <strong>${{ "%.2f"|format(expense.amount) }}</strong><br>
                            <small class="text-muted">
                                {% if expense.paid_by_id == user.id %}
                                    You paid
                                {% else %}
                                    {{ expense.paid_by.name }} paid
                                {% endif %}
                            </small>
                        </div>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p class="text-muted text-center">No recent expenses.</p>
        {% endif %}
    </div>
</div>

{% endblock %}